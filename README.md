# Телекоммуникационная биллинговая система "Ромашка"

## Обзор проекта

Проект представляет собой распределенную микросервисную систему биллинга для телекоммуникационной компании "Ромашка". Система обрабатывает данные о вызовах абонентов, тарифицирует их согласно тарифным планам и производит расчеты.

## Архитектура системы

Система построена на основе микросервисной архитектуры с использованием Spring Cloud и следует принципам:
- Независимое масштабирование сервисов
- Изоляция ответственности
- Асинхронная коммуникация через RabbitMQ
- Централизованная конфигурация (Spring Cloud Config)
- Сервисное обнаружение (Eureka)

### Основные компоненты

## Основные сервисы

### CDR-сервис 

CDR-сервис отвечает за генерацию и управление данными о вызовах абонентов:
- Генерирует исторические и новые записи о звонках
- Сохраняет CDR в базе данных
- Отправляет пакеты CDR в BRT-сервис через RabbitMQ

[Подробнее о CDR-сервисе](https://github.com/is6769/NXB-CDRService/blob/main/README.md)

### BRT-сервис 

BRT-сервис выполняет обработку вызовов в реальном времени:
- Получает CDR от CDR-сервиса
- Фильтрует и обрабатывает записи для тарификации
- Взаимодействует с HRS-сервисом для тарификации
- Управляет балансами абонентов

[Подробнее о BRT-сервисе](https://github.com/is6769/NXB-BRTService/blob/main/README.md)

### HRS-сервис 

HRS-сервис отвечает за тарификацию и расчет стоимости услуг:
- Применяет правила тарификации согласно тарифным планам
- Управляет пакетами услуг и их лимитами
- Формирует счета для абонентов
- Отслеживает циклы тарификации

[Подробнее о HRS-сервисе](https://github.com/is6769/NXB-HRSService/blob/main/README.md)

### Инфраструктурные сервисы

- **Config Server** - централизованное управление конфигурациями
- **Eureka Server** - сервис обнаружения и регистрации микросервисов
- **API Gateway** - единая точка входа для внешних запросов

## Бизнес-процессы

### Обработка звонков

1. CDR-сервис генерирует запись о звонке
2. CDR-сервис отправляет пакет CDR в BRT-сервис
3. BRT-сервис проверяет, является ли абонент клиентом оператора "Ромашка"
4. BRT-сервис конвертирует CDR в формат для тарификации и отправляет в HRS
5. HRS-сервис определяет тарифный план абонента и применяет правила тарификации
6. HRS-сервис рассчитывает стоимость звонка с учетом пакетных лимитов
7. HRS-сервис отправляет счет обратно в BRT-сервис
8. BRT-сервис списывает средства с баланса абонента

### Управление тарифами

1. Абонент выбирает тарифный план через API
2. Запрос на смену тарифа поступает в HRS-сервис
3. HRS-сервис назначает выбранный тариф абоненту
4. HRS-сервис инициализирует пакеты услуг и лимиты
5. HRS-сервис выставляет абонентскую плату (если есть)
6. HRS-сервис отправляет счет в BRT-сервис
7. BRT-сервис списывает абонентскую плату с баланса

### Обновление тарифного периода

1. HRS-сервис отслеживает окончание сроков действия тарифов
2. При истечении срока тарифа, HRS-сервис автоматически продлевает его
3. Инициализируются новые пакеты услуг и лимиты
4. Выставляется абонентская плата за следующий период
5. Счет отправляется в BRT-сервис для списания средств

## Тарифные планы

### Классика
- Поминутная тарификация без абонентской платы
- 1.5 у.е. за минуту для звонков внутри сети
- 2.5 у.е. за минуту для звонков на другие сети
- Входящие звонки бесплатны

### Помесячный
- Абонентская плата 100 у.е. в месяц
- 50 минут в пакете бесплатно
- После исчерпания пакета - тарификация по тарифу "Классика"
- Период тарифного плана - 30 дней

## Технический стек

- **Java 17**
- **Spring Boot/Spring Cloud** - фреймворк для разработки
- **Spring Cloud Config** - управление конфигурациями
- **Spring Cloud Netflix Eureka** - сервисное обнаружение
- **PostgreSQL** - основная база данных
- **H2** - in-memory база для CDR-сервиса
- **RabbitMQ** - очередь сообщений
- **Liquibase** - управление миграциями БД
- **Maven** - сборка проекта
- **Docker** - контейнеризация
- **Docker Compose** - оркестрация контейнеров
